# wkt-crs-go

Parser for Well Known Text (WKT) Coordinate Reference System (CRS) for golang.

It supports v1 of the language specification.

Grammar is available at [ANTLR grammars](https://github.com/antlr/grammars-v4) repo;

The parser is generated by ANTLR for go target.
There are no ANTLR visitor nor listener generated, as I find them rather useless from code point of view.

Grammar is basically having two main entry rules:

- `propsFile` is accepting properties file 
  - like the one from [GeoTools epsg.properties](https://raw.githubusercontent.com/geotools/geotools/main/modules/plugin/epsg-wkt/src/main/resources/org/geotools/referencing/epsg/wkt/epsg.properties)
- `wkt` is accepting single definition WKT text

The parser can be used to read WKT and provide AST.
Instead there are few other visitors, which can be used as basis for whatever else is required:

- `to_text` is simple identity print of AST i.e. it prints content as-is, white space removed.
- `to_map` is converting AST to array of objects and properties (represented as map[string]interface{}). this can used to directly write it as `json`.
- `to_pretty_text` is converting AST into text indented format.

## Usage

In the core of it is ANTLR generated lexer and parser code.

Obtain character stream for the data you want to parse:

```go
is, err := antlr.NewFileStream("target/epsg.properties")
require.NoError(t, err)
```

then parse it:

```go
lexer := wktcrsv1.Newwktcrsv1Lexer(is)
stream := antlr.NewCommonTokenStream(lexer, 0)
parser := wktcrsv1.Newwktcrsv1Parser(stream)
parser.AddErrorListener(antlr.NewDiagnosticErrorListener(true))
parser.BuildParseTrees = true
return parser
```

then use the parser rule which represents most closely your input:

- for epsg.properties file, use `parser.PropsFile()`
- for plain WKT definition, use `parser.Wkt()`

Returned node is root of the AST and one can use visitor patter to process it.
See examples in `to_map.go` and similar.

## V1 support

WKT CRS V1 reference: [Specification](https://docs.ogc.org/is/12-063r5/12-063r5.html)

The grammar tries to adhere to the spec but have not made extensive tests.

This grammar is extended with ability to parse properties file, containing EPSG=WKTCRS type of definitions.

For example one can parse [GeoTools epsg.properties](https://raw.githubusercontent.com/geotools/geotools/main/modules/plugin/epsg-wkt/src/main/resources/org/geotools/referencing/epsg/wkt/epsg.properties) directly.

If the input is properties file, use `propsFile` starting rule.

If the input is pure WKT, use `wkt` starting rule.
