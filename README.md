# wkt-crs-go

Parser for Well Known Text (WKT) Coordinate Reference System (CRS) for golang.

It supports version 1 (see references).

References:

- [WKT](https://en.wikipedia.org/wiki/Well-known_text_representation_of_coordinate_reference_systems)
- [WKT v1](https://github.com/geotools/geotools/blob/main/modules/library/opengis/src/main/java/org/opengis/referencing/doc-files/WKT.html)

Grammar itself is maintained at [ANTLR grammars](https://github.com/antlr/grammars-v4) repo;

The parser is generated by ANTLR for `go` target.
There are no ANTLR visitor nor listener generated, as they are rather useless from code point of view.

There are two main entry rules:

- `propsFile` is accepting properties file 
  - like the one from [GeoTools epsg.properties](https://raw.githubusercontent.com/geotools/geotools/main/modules/plugin/epsg-wkt/src/main/resources/org/geotools/referencing/epsg/wkt/epsg.properties)
- `wkt` is accepting single definition WKT text

The parser can be used to read WKT and provide AST.

There are few sample visitors, which can be used as basis for whatever else is required:

- `to_text` is simple identity print of AST i.e. it prints content as-is, white space removed.
- `to_map` is converting AST to array of objects and properties (represented as map[string]interface{}). 
  - these can be written as `json`.
- `to_pretty_text` is converting AST to text indented format.

## Usage

In the core of it is ANTLR generated lexer and parser code.

Obtain character stream for the data you want to parse:

```go
is, err := antlr.NewFileStream("target/epsg.properties")
require.NoError(t, err)
```

Then parse it and return the starting rule:

```go
lexer := wktcrsv1.Newwktcrsv1Lexer(is)
stream := antlr.NewCommonTokenStream(lexer, 0)
parser := wktcrsv1.Newwktcrsv1Parser(stream)
parser.AddErrorListener(antlr.NewDiagnosticErrorListener(true))
parser.BuildParseTrees = true
return parser
```

Then use the parser rule which represents most closely your input to start the tree building:

- for epsg.properties file, use `parser.PropsFile()`
- for plain WKT definition, use `parser.Wkt()`

Returned node is the root of the AST and one can use visitor patter to process it.
See examples in `to_map.go` and similar.
